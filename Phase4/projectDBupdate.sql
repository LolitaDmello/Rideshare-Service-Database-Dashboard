--(1) INSERT
--Insert 2 new passengers and their booking details.
--passenger
insert into Fall22_S003_12_PASSENGER VALUES ('100301', 'Alan', 'Yen', 'M', TO_DATE( '2000-12-15', 'YYYY-MM-DD'), 8273453374, 'Alan.Yen@gmail.com');
insert into Fall22_S003_12_PASSENGER VALUES ('100302', 'Helen', 'Green', 'F', TO_DATE( '1998-05-16', 'YYYY-MM-DD'), 8468343274, 'Helen.Green@gmail.com');

--payment
insert into Fall22_S003_12_PAYMENT VALUES ('500301', 564286594315, TO_DATE('2024/01','YYYY/MM') , '100301');
insert into Fall22_S003_12_PAYMENT VALUES ('500302', 588285694315, TO_DATE('2025/03','YYYY/MM') , '100302');

--booking
insert into Fall22_S003_12_BOOKING values ('BK80','Addison',88466,'Plano',82873,30.45,'500301','100301',TO_DATE('2023-05-04','YYYY-MM-DD'),TO_DATE('2023-05-04 15:08:00','YYYY-MM-DD HH24:MI:SS'),3,1001);
insert into Fall22_S003_12_BOOKING values ('BK81','Coppell',76640,'Garland',51287,43.77,'500302','100302',TO_DATE('2023-05-17','YYYY-MM-DD'),TO_DATE('2023-05-17 19:00:00' ,'YYYY-MM-DD HH24:MI:SS'),4,1002);
insert into Fall22_S003_12_BOOKING values ('BK82','Frisco',21315,'Irving',66392,27.25,'500301','100301',TO_DATE('2023-06-06','YYYY-MM-DD') ,TO_DATE('2023-06-06 18:22:00','YYYY-MM-DD HH24:MI:SS') ,1,1003);
--desc FALL22_S003_12_BOOKING;

--rideschedule
insert into Fall22_S003_12_RIDESCHEDULE values ('RD81','BK80',TO_TIMESTAMP('2023-05-04 15:48:00','YYYY-MM-DD HH24:MI:SS'),TO_TIMESTAMP('2023-05-04 16:28:00','YYYY-MM-DD HH24:MI:SS'));
insert into Fall22_S003_12_RIDESCHEDULE values ('RD82','BK81',TO_TIMESTAMP('2023-05-17 19:20:00','YYYY-MM-DD HH24:MI:SS'),TO_TIMESTAMP('2023-05-17 19:55:00','YYYY-MM-DD HH24:MI:SS'));
insert into Fall22_S003_12_RIDESCHEDULE values ('RD83','BK82',TO_TIMESTAMP('2023-06-06 18:40:00','YYYY-MM-DD HH24:MI:SS') ,TO_TIMESTAMP('2023-06-06 19:05:00','YYYY-MM-DD HH24:MI:SS'));

COMMIT;


--(2) UPDATE
--Updating the booking amount for BOOKING.PSGID = '100228' which will change the rank of this passenger and the results of query 3.
-- For BID = 'BK60' and PSGID = '100228'-> Update FAREAMOUNT FROM 50 TO 68.

UPDATE FALL22_S003_12_BOOKING SET FAREAMOUNT = 68 WHERE PSGID = '100228' AND BID = 'BK60';

COMMIT;

--The output of Query3 in the BR document is changed because of the update.

select PID, FIRSTNAME, LASTNAME, SUM(FAREAMOUNT) AS TOTAL_AMOUNT, RANK() OVER (ORDER BY SUM(FAREAMOUNT) DESC) AS RANK_AMOUNT
FROM 
    Fall22_S003_12_PASSENGER PA INNER JOIN FALL22_S003_12_BOOKING BK ON PA.PID = BK.PSGID 
WHERE 
	BDATE BETWEEN TO_DATE('2023-05-01','YYYY-MM-DD') AND TO_DATE('2023-05-31','YYYY-MM-DD')
GROUP BY 
  PSGID,  FIRSTNAME, LASTNAME, PID
ORDER BY SUM(FAREAMOUNT) DESC
FETCH FIRST 3 ROWS ONLY;


--(3) DELETE
--Delete record for PassengerID = '100302'

DELETE FROM Fall22_S003_12_RIDESCHEDULE WHERE BID IN (SELECT BID FROM Fall22_S003_12_BOOKING WHERE PSGID = '100302');
DELETE FROM Fall22_S003_12_BOOKING WHERE PSGID = '100302';
DELETE FROM Fall22_S003_12_PAYMENT WHERE PSGID = '100302';
DELETE FROM Fall22_S003_12_PASSENGER WHERE PID = '100302';

COMMIT;

